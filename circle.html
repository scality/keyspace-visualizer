<!DOCTYPE html>
<meta charset="utf-8">
<script src="js/d3.v3.js"></script>
<body>
    <div class="radio-group">
        <input type="radio" id="rcos0" name="radio-group"><label for="rcos0">Cos0</label>
        <input type="radio" id="rcos1" name="radio-group"><label for="rcos1">Cos1</label>
        <input type="radio" id="rcos2" name="radio-group" checked="checked"><label for="rcos2">Cos2</label>
        <input type="radio" id="rcos3" name="radio-group"><label for="rcos3">Cos3</label>
        <input type="radio" id="rcos4" name="radio-group"><label for="rcos4">Cos4</label>
        <input type="radio" id="rcos5" name="radio-group"><label for="rcos5">Cos5</label>
        <input type="radio" id="rarc12" name="radio-group"><label for="rarc12">Schema12</label>
        <input type="radio" id="rarc18" name="radio-group"><label for="rarc18">Schema18</label>
    </div>

    <svg width="400" height="400" style="background-color: gray;"></svg>

<script>
// List of predefined angles
var coses = {
    "rcos0": { "schema": 6, "part": [0] },
    "rcos1": { "schema": 6, "part": [0, 3] },
    "rcos2": { "schema": 6, "part": [0, 2, 4] },
    "rcos3": { "schema": 6, "part": [0, 3, 2, 5] },
    "rcos4": { "schema": 6, "part": [0, 3, 2, 5, 1] },
    "rcos5": { "schema": 6, "part": [0, 3, 2, 5, 1, 4] },
    "rarc12": { "schema": 12, "part": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11] },
    "rarc18": { "schema": 18, "part": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17] }
};

var svg = d3.select("svg");

var width = svg.attr("width"),
    height = svg.attr("height"),
    radius = Math.min(width, height) * 0.5,
    originx = width / 2,
    originy = height / 2;

svg
    .append("g")
    .attr("class", "visu")
svg
    .append("g")
    .attr("class", "lines")
svg
    .append("g")
    .attr("class", "arrows")

// Starting draw point in the svg
// rotate -90Â° to start at noon
svg.selectAll("g.visu, g.lines, g.arrows")
    .attr("transform", "translate(" + originx + "," + originy + ") rotate(-90, 0, 0)");

// Draw circle
svg.select("g.visu")
    .append("circle")
    .attr("class", "circle")
    .attr("y1", -(radius * 0.8))
    .attr("y2", (radius * 0.8))
    .attr("r", (radius * 0.8))
    .style("fill", "none")
    .style("stroke", "blue")
    .style("stroke-width", "5px")

function cosDegree(degrees) {
    return Math.cos( degrees * Math.PI / 180);
}
function sinDegree(degrees) {
    return Math.sin( degrees * Math.PI / 180);
}

/**
 * Takes schema and slice numbers
 * Return array of angles
 */
function partsToAngles(data) {
    var angles = [],
        x = -1,
        n = data.part.length;
    while(++x < data.schema) {
        // Populate angle only with the desired angles
        var y = -1;
        while(++y < n) {
            if( x == data.part[y] ) {
                angles.push( { "angle": (360 / data.schema * x) } );
                break;
            }
        }
    }
    return angles;
};

// default view at init
change( partsToAngles(coses.rcos2) );
// hanle other views
d3.selectAll('input[name="radio-group"]')
    .on("change", function() {
        labelType = this.id
        var angles = partsToAngles(coses[labelType]);
        change(angles);
    });

// Display the angles
function change(data) {
    var radline = radius * 0.9

    var lines = svg.select("g.lines")
        .selectAll("line")
        .data(data, function(d) { return d.angle; });

    lines.enter()
        .append("line")
        .attr("x1", 0)
        .attr("y1", 0)
        .attr("x2", function(d) { return cosDegree(d.angle) * radline; })
        .attr("y2", function(d) { return sinDegree(d.angle) * radline; })
        .style("fill", "none")
        .style("stroke", "black")
        .style("stroke-width", "2px")
    
    lines.exit()
        .remove();

    var anchor = svg.select("g.arrows")
        .selectAll("circle")
        .data(data, function(d) { return d.angle; });

    anchor.enter()
        .append("circle")
        .attr("cx", function(d) { return cosDegree(d.angle) * radline; })
        .attr("cy", function(d) { return sinDegree(d.angle) * radline; })
        .attr("r", 10)
        .style("fill", function(d, i) { if(i == 0) { return "green" } else { return "blue" }; })
        .style("stroke", "black")
        .style("stroke-width", "1px")

    anchor
        .on('mousedown', function(d, i) {
            var timedOut = 0
            svg.on('mousemove', function(elem, i) {
                    if(!timedOut) {
                        var x = originx - d3.mouse(this)[0];
                        var y = originy - d3.mouse(this)[1];
                        var radian = Math.atan2(y, x); // In radians
                        var degree = radian * (180 / Math.PI) + 180; 
                        //console.log("x:"+x+" y:"+y+" rad:"+rad+" deg:"+deg)
                        svg.selectAll("g.arrows, g.lines")
                            .attr("transform", "translate("+ originx +","+ originy +") rotate("+ degree +", 0, 0)");
                    }

                    timedOut = 1
                    // add 10ms latency to not overlad the cpu
                    setTimeout(function() { timedOut = 0 }, 10)
                })
        .on('mouseup', function(e) {
            svg.on('mousemove', null);
        })
    });

    anchor.exit()
        .remove();
}
</script> 

</body>
</html>
